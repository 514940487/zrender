<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Path to Bezier</title>
    <script src="lib/rollup.browser.js"></script>
    <script src="lib/requireES.js"></script>
    <script src="lib/config.js"></script>
</head>
<body>
    <style>
        html, bod {
            width: 100%;
            height: 100%;
            margin: 0;
        }
    </style>
    <canvas id="main" width="1600" height="1000"></canvas>
    <script>
        requireES([
            "zrender/lib/core/PathProxy",
            "zrender/lib/tool/convertPath",
            "zrender/lib/tool/morphPath",
        ], function(PathProxy, {pathToBezierCurves}, {alignBezierCurves}) {

            const canvas = document.querySelector('#main');
            const ctx = canvas.getContext('2d');

            const R = 20;
            const G = 50;

            function drawBezier(data) {
                ctx.beginPath();
                for (let i = 0; i < data.length;) {
                    i === 0 && ctx.moveTo(data[i++], data[i++]);
                    ctx.bezierCurveTo(data[i++], data[i++], data[i++], data[i++], data[i++], data[i++]);
                }
            }

            function buildCircle() {
                for (let k = 0; k < 4; k++) {
                    for (let i = 0; i < 5; i++) {
                        for (let j = 0; j < 5; j++) {
                            const x = i * 5 + j;
                            const sign = 1 - (k % 2) * 2;
                            const startAngle = Math.PI * 2 * (1 - (i + 1) / 6);
                            const endAngle = startAngle + (Math.PI * 2 * (1 - (j + 1) / 6));
                            const circleArgs = [x * G + G, G + k * G * 2, R, startAngle, endAngle, k < 2];
                            const circlePath = new PathProxy.default();
                            circlePath.beginPath();
                            circlePath.arc.apply(circlePath, circleArgs);
                            const arr = pathToBezierCurves(circlePath);

                            ctx.beginPath();
                            ctx.arc.apply(ctx, circleArgs);
                            ctx.strokeStyle = 'green';
                            ctx.lineWidth = 2;
                            ctx.stroke();

                            ctx.save();
                            ctx.translate(0, G);
                            ctx.strokeStyle = 'red';
                            ctx.lineWidth = 1;
                            drawBezier(arr[0]);
                            ctx.stroke();
                            ctx.restore();
                        }
                    }
                }
            }

            function buildPolygon() {
                for (let k = 0; k < 25; k++) {
                    const polygonPoints = [];
                    const N = k + 3;
                    const dStep = 2 * Math.PI / N;
                    for (let i = 0; i < N; i++) {
                        polygonPoints.push(
                            [k * G + G + Math.cos(i * dStep) * R, G * 10 + Math.sin(i * dStep) * R]
                        );
                    }

                    const polygonPath = new PathProxy.default();
                    for (let i = 0; i < polygonPoints.length; i++) {
                        const x = polygonPoints[i][0];
                        const y = polygonPoints[i][1];
                        i === 0 ? polygonPath.moveTo(x, y) : polygonPath.lineTo(x, y);
                    }
                    polygonPath.closePath();
                    const arr = pathToBezierCurves(polygonPath);

                    ctx.beginPath();
                    ctx.strokeStyle = 'green';
                    ctx.lineWidth = 2;
                    for (let i = 0; i < polygonPoints.length; i++) {
                        const x = polygonPoints[i][0];
                        const y = polygonPoints[i][1];
                        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    ctx.stroke();

                    ctx.save();
                    ctx.translate(0, G);
                    ctx.strokeStyle = 'red';
                    ctx.lineWidth = 1;
                    drawBezier(arr[0]);
                    ctx.stroke();
                    ctx.restore();
                }
            }

            const circleCurves = buildCircle();
            const polygonCurves = buildPolygon();
        });
    </script>
</body>
</html>